#!/usr/bin/env sh
set -e

DIR=$( cd "$( dirname "$0" )" && pwd )
COMPOSER="$DIR/composer install --prefer-dist --no-interaction --ansi --optimize-autoloader --profile"
COMPOSER_SHOW_INSTALLED="composer show --installed"

if [[ "$1" = '--dev' ]] ; then
    COMPOSER="$COMPOSER"
else
    COMPOSER="$COMPOSER --no-dev"
fi

# download, update composer
if [ ! -f "$DIR/composer" ]; then
    curl --silent http://composer/installer | sh -s -- "$DIR/composer"
fi

$COMPOSER

if [ -n "$HAL_ENVIRONMENT" ]; then
    "$DIR/"$COMPOSER_SHOW_INSTALLED
fi
