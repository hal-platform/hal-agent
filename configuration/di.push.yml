services:

    push.resolver:
        class: 'QL\Hal\Agent\Push\Resolver'
        arguments:
            - @logger.event
            - @push.repo
            - @clock
            - %push.sshUser%
            - %environment.path%
            - %environment.archive%
            - %github.baseurl.site%
        calls:
            - ['setBaseBuildDirectory', ['%environment.temp%']]
            - ['setHomeDirectory', ['%environment.home%']]

    push.mover:
        class: 'QL\Hal\Agent\Push\Mover'
        arguments:
            - @logger.event
            - @utility.filesystem

    push.unpacker:
        class: 'QL\Hal\Agent\Push\Unpacker'
        arguments:
            - @logger.event
            - @utility.process.builder= # = signifies a prototype service
            - @utility.filesystem
            - @yaml.dumper
            - %timeout.filepacking%

    push.configuration.reader:
        class: 'QL\Hal\Agent\Push\ConfigurationReader'
        arguments:
            - @logger.event
            - @utility.filesystem
            - @yaml.parser

    push.delta:
        class: 'QL\Hal\Agent\Push\CodeDelta'
        arguments:
            - @logger.event
            - @utility.process.builder= # = signifies a prototype service
            - @yaml.parser
            - @github.commits
            - %push.sshUser%

    push.builder:
        class: 'QL\Hal\Agent\Push\Builder'
        arguments:
            - @logger.event
            - @utility.process.builder= # = signifies a prototype service
            - %timeout.push.build%

    push.pusher:
        class: 'QL\Hal\Agent\Push\Pusher'
        arguments:
            - @logger.event
            - @utility.process.builder= # = signifies a prototype service
            - %timeout.push%

    push.serverCommand:
        class: 'QL\Hal\Agent\Push\ServerCommand'
        arguments:
            - @logger.event
            - @utility.process.builder= # = signifies a prototype service
            - %push.sshUser%
            - %timeout.push.serverCommand%

    # private services used only by push actions

    yaml.dumper:
        class: 'Symfony\Component\Yaml\Dumper'
        calls:
            - ['setIndentation', ['4']]
