services:
    build.resolver:
        class: 'QL\Hal\Agent\Build\Resolver'
        arguments:
            - @build.repo
            - @utility.process.builder= # = signifies a prototype service
            - %environment.path%
            - %environment.archive%
        calls:
            - ['setBaseBuildDirectory', ['%environment.temp%']]
            - ['setHomeDirectory', ['%environment.home%']]
    build.downloader:
        class: 'QL\Hal\Agent\Build\Downloader'
        arguments: [@logger.event, @github.archive]
    build.unpacker:
        class: 'QL\Hal\Agent\Build\Unpacker'
        arguments:
            - @logger.event
            - @utility.process.builder= # = signifies a prototype service
            - %timeout.filepacking%
    build.configuration.reader:
        class: 'QL\Hal\Agent\Build\ConfigurationReader'
        arguments:
            - @logger.event
            - @utility.filesystem
            - @yaml.parser

    build.builder:
        class: 'QL\Hal\Agent\Build\DelegatingBuilder'
        arguments:
            - @logger.event
            - @service_container
            -
                unix: build.unix.handler
                windows: build.windows.handler
    build.packer:
        class: 'QL\Hal\Agent\Build\Packer'
        arguments:
            - @logger.event
            - @utility.filesystem
            - @utility.process.builder= # = signifies a prototype service
            - %timeout.filepacking%
    build.mover:
        class: 'QL\Hal\Agent\Build\Mover'
        arguments:
            - @logger.event
            - @utility.filesystem

    # unix
    build.unix.handler:
        class: 'QL\Hal\Agent\Build\Unix\UnixBuildHandler'
        arguments:
            - @logger.event
            - @build.unix.preparer
            - @build.unix.builder

    build.unix.preparer:
        class: 'QL\Hal\Agent\Build\PackageManagerPreparer'
        arguments:
            - @logger.event
            - @utility.filesystem
            - %github.com.token%
    build.unix.builder:
        class: 'QL\Hal\Agent\Build\Unix\Builder'
        arguments:
            - @logger.event
            - @utility.process.builder= # = signifies a prototype service
            - %timeout.build%

    # windows
    build.windows.handler:
        class: 'QL\Hal\Agent\Build\Windows\WindowsBuildHandler'
        arguments:
            - @logger.event
            - @build.windows.preparer
            - @build.windows.exporter
            - @build.windows.builder
            - @build.windows.importer
            - @build.windows.cleaner

    build.windows.preparer:
        class: 'QL\Hal\Agent\Build\PackageManagerPreparer'
        arguments:
            - @logger.event
            - @utility.filesystem
            - %github.com.token%

    build.windows.exporter:
        class: 'QL\Hal\Agent\Build\Windows\Exporter'
        arguments:
            - @logger.event
            - @build.windows.standard.remoter
            - @utility.process.builder= # = signifies a prototype service
            - %timeout.filetransfer%
            - %build.remoteUser%

    build.windows.builder:
        class: 'QL\Hal\Agent\Build\Windows\Builder'
        arguments:
            - @logger.event
            - @build.windows.build.remoter

    build.windows.importer:
        class: 'QL\Hal\Agent\Build\Windows\Importer'
        arguments:
            - @logger.event
            - @utility.process.builder= # = signifies a prototype service
            - %timeout.filetransfer%
            - %build.remoteUser%

    build.windows.cleaner:
        class: 'QL\Hal\Agent\Build\Windows\Cleaner'
        arguments:
            - @build.windows.standard.remoter

    build.windows.build.remoter:
        class: 'QL\Hal\Agent\RemoteProcess'
        arguments:
            - @logger.event
            - %build.remoteUser%
            - %ssh.keyPath%
            - %timeout.build%
    build.windows.standard.remoter:
        class: 'QL\Hal\Agent\RemoteProcess'
        arguments:
            - @logger.event
            - %build.remoteUser%
            - %ssh.keyPath%
            - %timeout.standard%
