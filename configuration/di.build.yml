services:
    build.resolver:
        class: 'QL\Hal\Agent\Build\Resolver'
        arguments:
            - @build.repo
            - @utility.process.builder= # = signifies a prototype service
            - %environment.path%
            - %environment.archive%
        calls:
            - ['setBaseBuildDirectory', ['%environment.temp%']]
            - ['setHomeDirectory', ['%environment.home%']]
    build.downloader:
        class: 'QL\Hal\Agent\Build\Downloader'
        arguments: [@logger.event, @github.archive]
    build.unpacker:
        class: 'QL\Hal\Agent\Build\Unpacker'
        arguments:
            - @logger.event
            - @utility.process.builder= # = signifies a prototype service
            - %timeout.filepacking%
    build.configuration.reader:
        class: 'QL\Hal\Agent\Build\ConfigurationReader'
        arguments:
            - @logger.event
            - @utility.filesystem
            - @yaml.parser

    build.builder:
        class: 'QL\Hal\Agent\Build\DelegatingBuilder'
        arguments:
            - @logger.event
            - @service_container
            -
                unix: build.unix.builder
                windows: build.windows.builder
    build.packer:
        class: 'QL\Hal\Agent\Build\Packer'
        arguments:
            - @logger.event
            - @utility.filesystem
            - @utility.process.builder= # = signifies a prototype service
            - %timeout.filepacking%
    build.mover:
        class: 'QL\Hal\Agent\Build\Mover'
        arguments:
            - @logger.event
            - @utility.filesystem

    # unix
    build.unix.builder:
        class: 'QL\Hal\Agent\Build\Unix\Builder'
        arguments:
            - @logger.event
            - @build.unix.preparer
            - @build.unix.builder.command

    build.unix.preparer:
        class: 'QL\Hal\Agent\Build\PackageManagerPreparer'
        arguments:
            - @logger.event
            - @utility.filesystem
            - %github.com.token%
    build.unix.builder.command:
        class: 'QL\Hal\Agent\Build\Unix\BuildCommand'
        arguments:
            - @logger.event
            - @utility.process.builder= # = signifies a prototype service
            - %timeout.build%

    # windows
    build.windows.builder:
        class: 'QL\Hal\Agent\Build\Windows\Builder'
        arguments:
            - @logger.event
            - @build.windows.preparer
            - @build.windows.builder.command

    build.windows.preparer:
        class: 'QL\Hal\Agent\Build\PackageManagerPreparer'
        arguments:
            - @logger.event
            - @utility.filesystem
            - %github.com.token%
    build.windows.builder.command:
        class: 'QL\Hal\Agent\Build\Windows\BuildCommand'
        arguments:
            - @logger.event
            - @utility.process.builder= # = signifies a prototype service
            - %timeout.build%

