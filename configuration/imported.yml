# Standalone installation only

imports:
    # These settings are imported from hal-core configuration
    -
        resource: ../vendor/ql/hal-core/config/di.yml
        # doctrine.em
        # build.repo
        # consumer.repo
        # deployment.repo
        # environment.repo
        # group.repo
        # push.repo
        # repository.repo
        # consumer.repo
        # serverproperty.repo
        # server.repo
        # session.repo
        # subscription.repo
        # user.repo
    -
        resource: config.env.yml

services:

    # imported from global scope
    # %agent.logger.mcp.host%

    agent.logger:
        alias: 'logger.mcp'
    agent.logger.mcp.factory:
        alias: 'logger.mcp.factory'

    logger.mcp:
        scope: 'agent'
        class: 'MCP\Service\Logger\Logger'
        arguments: ['@logger.mcp.service', '@logger.mcp.factory']

    logger.mcp.service:
        scope: 'agent'
        class: 'MCP\Service\Logger\Service\GuzzleService'
        arguments: ['@logger.mcp.guzzle', '@logger.mcp.renderer', true]
    logger.mcp.guzzle:
        scope: 'agent'
        class: 'Guzzle\Http\Client'
        arguments: ['%agent.logger.mcp.host%']
    logger.mcp.renderer:
        scope: 'agent'
        class: 'MCP\Service\Logger\Renderer\XmlRenderer'
        arguments: ['@logger.mcp.writer']
    logger.mcp.writer:
        scope: 'agent'
        class: 'XMLWriter'

    logger.mcp.factory:
        scope: 'agent'
        class: 'MCP\Service\Logger\Adapter\Psr\MessageFactory'
        arguments: ['@logger.mcp.clock']
        calls:
          - ['setDefaultProperty', ['applicationId', '%agent.application.id%']]
          # replaced at runtime, maybe
          - ['setDefaultProperty', ['machineIPAddress', '@logger.mcp.serverIp']]
          # replaced at runtime
          - ['setDefaultProperty', ['machineName', 'localhost']]
    logger.mcp.serverIp:
        scope: 'agent'
        class: 'MCP\DataType\IPv4Address'
        factory_class: 'MCP\DataType\IPv4Address'
        factory_method: 'create'
        arguments: ['0.0.0.0']
    logger.mcp.clock:
        scope: 'agent'
        class: 'MCP\DataType\Time\Clock'
        arguments: ['now', 'UTC']

