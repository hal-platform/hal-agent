services:

    ####################################################################################################################
    # lazy commands
    ####################################################################################################################

    # management

    command.build.create:
        parent: 'command.template'
        arguments: ['management:build:create', 'executor.build.create']
        configurator: ['Hal\Agent\Executor\Management\CreateBuildCommand', 'configure']
    command.release.create:
        parent: 'command.template'
        arguments: ['management:release:create', 'executor.release.create']
        configurator: ['Hal\Agent\Executor\Management\CreateReleaseCommand', 'configure']


    lazy.command.build.remove:
        class: 'Hal\Agent\Command\LazyCommand'
        arguments: ['build:remove', 'command.build.remove', '@service_container']
    lazy.command.builds.list:
        class: 'Hal\Agent\Command\LazyCommand'
        arguments: ['builds:list', 'command.builds.list', '@service_container']
    command.release.create:
        class: 'Hal\Agent\Command\LazyCommand'
        arguments: ['push:create', 'command.push.create', '@service_container']

    # job runners

    command.runner.build:
        parent: 'command.template'
        arguments: ['runner:build', 'executor.runner.build']
        configurator: ['Hal\Agent\Executor\Runner\BuildCommand', 'configure']
    command.runner.deploy:
        parent: 'command.template'
        arguments: ['runner:deploy', 'executor.runner.deploy']
        configurator: ['Hal\Agent\Executor\Runner\DeployCommand', 'configure']

    # workers - cron

    command.worker.build:
        parent: 'command.template'
        arguments: ['worker:build', 'executor.worker.build']
        configurator: ['Hal\Agent\Executor\Worker\BuildCommand', 'configure']
    command.worker.deploy:
        parent: 'command.template'
        arguments: ['worker:deploy', 'executor.worker.deploy']
        configurator: ['Hal\Agent\Executor\Worker\DeployCommand', 'configure']

    # utility

    lazy.command.server.connections:
        class: 'Hal\Agent\Command\LazyCommand'
        arguments: ['server:connections', 'command.server.connections', '@service_container']

    # docker

    command.docker.refresh:
        parent: 'command.template'
        arguments: ['docker:refresh', 'executor.docker.refresh']
        configurator: ['Hal\Agent\Executor\Docker\UpdateSourcesCommand', 'configure']
    command.docker.status:
        parent: 'command.template'
        arguments: ['docker:status', 'executor.docker.status']
        configurator: ['Hal\Agent\Executor\Docker\CheckStatusCommand', 'configure']

    # shared

    command.template:
        class: 'Symfony\Component\Console\Command\Command'
        factory: ['@command.factory', 'build']

    command.factory:
        class: 'Hal\Agent\Command\HalCommandFactory'
        arguments: ['@service_container']

    ####################################################################################################################
    # commands
    ####################################################################################################################

    # management

    executor.build.create:
        class: 'Hal\Agent\Executor\Management\CreateBuildCommand'
        arguments:
            - '@doctrine.em'
            - '@clock'
            - '@utility.referenceResolver'
            - '@utility.id.generator'
    command.build.remove:
        class: 'Hal\Agent\Command\RemoveBuildCommand'
        arguments:
            - 'build:remove'
            - '@doctrine.em'
            - '@utility.filesystem'
        calls:
            - ['setArchivePath', ['%environment.archive%']]
    command.builds.list:
        class: 'Hal\Agent\Command\ListBuildsCommand'
        arguments:
            - 'builds:list'
            - '@doctrine.em'
            - '@utility.filesystem'
            - '%environment.archive%'
    executor.release.create:
        class: 'Hal\Agent\Executor\Management\CreateReleaseCommand'
        arguments:
            - '@doctrine.em'
            - '@clock'
            - '@utility.id.generator'

    # job runners

    executor.runner.build:
        class: 'Hal\Agent\Executor\Runner\BuildCommand'
        arguments:
            - '@logger.event'
            - '@build.resolver'
            - '@build.downloader'
            - '@build.unpacker'
            - '@build.configuration.reader'
            - '@build.builder'
            - '@build.packer'
            - '@build.mover'
            - '@utility.filesystem'
            - '@ssh.manager'
    executor.runner.deploy:
        class: 'Hal\Agent\Executor\Runner\DeployCommand'
        arguments:
            - '@logger.event'
            - '@push.resolver'
            - '@push.mover'
            - '@push.unpacker'
            - '@push.configuration.reader'
            - '@push.builder'
            - '@push.deployer'
            - '@utility.filesystem'

    # workers - cron

    executor.worker.build:
        class: 'Hal\Agent\Executor\Worker\BuildCommand'
        arguments:
            - '@doctrine.em'
            - '@utility.process.builder'
            - '@mcp.logger'
            - '@root'
    executor.worker.deploy:
        class: 'Hal\Agent\Executor\Worker\DeployCommand'
        arguments:
            - '@doctrine.em'
            - '@utility.process.builder'
            - '@mcp.logger'
            - '@root'

    # utility

    command.server.connections:
        class: 'Hal\Agent\Command\Utility\VerifyServerConnectionsCommand'
        arguments:
            - 'server:connections'
            - '@doctrine.em'
            - '@ssh.manager'
            - '@redis'
            - '@clock'
            - '%push.rsync.remoteUser%'

    # docker

    executor.docker.refresh:
        class: 'Hal\Agent\Executor\Docker\UpdateSourcesCommand'
        arguments:
            - '@ssh.filemanager'
            - '@utility.process.builder'
            - '@github.archive'
            - '%environment.temp%'
            - '%build.unix.remoteUser%'
            - '%build.unix.server%'
            - '%docker.source.path%'
            - '%docker.source.repository%'
            - '%docker.source.reference%'
    executor.docker.status:
        class: 'Hal\Agent\Executor\Docker\CheckStatusCommand'
        arguments:
            - '@ssh.manager'
            - '@redis'
            - '@clock'
            - '%build.unix.remoteUser%'
            - '%build.unix.server%'
            - '%docker.option.sudo%'
            - '%environment.temp%'
            - '%build.unix.temp%'
