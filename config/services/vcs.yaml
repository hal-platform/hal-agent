services:
    ####################################################################################################################
    # vcs
    ####################################################################################################################

    vcs:
        class: 'Hal\Core\VersionControl\VCS'
        arguments:
            -
                ghe: '@vcs.github_enterprise'
                gh: '@vcs.github'

    vcs.github:
        class: 'Hal\Core\VersionControl\VCS\GitHubVCS'
        arguments:
            - '@github.http_cache.plugin'
            - '@github.http.builder'
            - 'https://github.com'
        calls:
            - ['setCache', ['@vcs.cache']]

    vcs.github_enterprise:
        class: 'Hal\Core\VersionControl\VCS\GitHubEnterpriseVCS'
        arguments:
            - '@github.http_cache.plugin'
            - '@github_enterprise.http.builder'
        calls:
            - ['setCache', ['@vcs.cache']]

    vcs.cache:
        parent: 'cache.memory'

    ####################################################################################################################
    # downloading (cant use github sdk for this)
    ####################################################################################################################

    github.archive_downloader:
        class: 'Hal\Agent\VersionControl\GitHub\ArchiveDownloader'
        arguments:
            - '@github.archive_guzzle'

    github.archive_guzzle:
        class: 'GuzzleHttp\Client'

    ####################################################################################################################
    # github sdk
    ####################################################################################################################

    github.http.builder:
        class: 'Github\HttpClient\Builder'
    github_enterprise.http.builder:
        class: 'Github\HttpClient\Builder'

    github.http_cache.plugin:
        class: 'Hal\Core\VersionControl\GitHub\MCPCachePlugin'
        arguments:
            - '@cache.github'
            - '@github.http_cache.http_stream_factory'
            -
                respect_cache_headers: false
                default_ttl: '%cache.github.default.ttl%'
            - '%cache.github.short.ttl%'

    github.http_cache.http_stream_factory:
        class: 'Http\Message\StreamFactory\GuzzleStreamFactory'
